# API Documentation - Elder Care Connect

T√†i li·ªáu chi ti·∫øt v·ªÅ c√°c API endpoints c·ªßa h·ªá th·ªëng Elder Care Connect.

## üåê Base URL

```
http://localhost:8000
```

Ho·∫∑c t·ª´ mobile device:

```
http://192.168.2.224:8000
```

## üìã Endpoints Overview

| Method | Endpoint            | Description               |
| ------ | ------------------- | ------------------------- |
| GET    | `/health`           | Health check              |
| POST   | `/api/match`        | Match caregivers (Web)    |
| POST   | `/api/match-mobile` | Match caregivers (Mobile) |

## üîç API Details

### 1. Health Check

**Endpoint:** `GET /health`

**Description:** Ki·ªÉm tra tr·∫°ng th√°i server

**Response:**

```json
{
  "status": "healthy",
  "timestamp": "2025-01-09T15:30:00Z",
  "version": "1.0.0"
}
```

---

### 2. Match Caregivers (Web)

**Endpoint:** `POST /api/match`

**Description:** T√¨m ki·∫øm caregivers ph√π h·ª£p cho request t·ª´ web interface

**Request Body:**

```json
{
  "request_id": "req_001"
}
```

**Request Schema:**

```json
{
  "type": "object",
  "properties": {
    "request_id": {
      "type": "string",
      "description": "ID c·ªßa request trong requests.json",
      "example": "req_001"
    }
  },
  "required": ["request_id"]
}
```

**Response Schema:**

```json
{
  "type": "object",
  "properties": {
    "request_id": {
      "type": "string",
      "description": "ID c·ªßa request"
    },
    "care_level": {
      "type": "integer",
      "description": "M·ª©c ƒë·ªô chƒÉm s√≥c (1-4)",
      "minimum": 1,
      "maximum": 4
    },
    "seeker_name": {
      "type": "string",
      "description": "T√™n ng∆∞·ªùi t√¨m ki·∫øm"
    },
    "location": {
      "type": "object",
      "properties": {
        "address": { "type": "string" },
        "lat": { "type": "number" },
        "lon": { "type": "number" }
      }
    },
    "total_matches": {
      "type": "integer",
      "description": "T·ªïng s·ªë caregivers ph√π h·ª£p"
    },
    "recommendations": {
      "type": "array",
      "items": {
        "$ref": "#/components/schemas/CaregiverRecommendation"
      }
    }
  }
}
```

**Example Response:**

```json
{
  "request_id": "req_001",
  "care_level": 3,
  "seeker_name": "Tr·∫ßn VƒÉn A",
  "location": {
    "address": "Qu·∫≠n 7, TP.HCM",
    "lat": 10.735,
    "lon": 106.72
  },
  "total_matches": 1,
  "recommendations": [
    {
      "rank": 1,
      "caregiver_id": "cg_001",
      "name": "Nguy·ªÖn Th·ªã Mai",
      "age": 35,
      "gender": "female",
      "rating": 4.8,
      "total_reviews": 62,
      "years_experience": 7,
      "price_per_hour": 85000,
      "distance_km": 0.29,
      "distance": "290m",
      "avatar": "https://ui-avatars.com/api/?name=NT&background=4ECDC4&color=fff&size=120",
      "experience": "7 nƒÉm kinh nghi·ªám",
      "isVerified": false,
      "match_score": 0.767,
      "match_percentage": "76%",
      "score_breakdown": {
        "credential": 0.8,
        "skills": 0.9,
        "distance": 0.95,
        "time": 1.0,
        "rating": 0.96,
        "experience": 0.7,
        "price": 0.8,
        "trust": 0.85
      }
    }
  ]
}
```

---

### 3. Match Caregivers (Mobile)

**Endpoint:** `POST /api/match-mobile`

**Description:** T√¨m ki·∫øm caregivers cho mobile application

**Request Body:**

```json
{
  "seeker_name": "Ng∆∞·ªùi d√πng",
  "care_level": 3,
  "health_status": "weak",
  "elderly_age": 78,
  "caregiver_age_range": [30, 55],
  "gender_preference": null,
  "required_years_experience": 3,
  "overall_rating_range": [3.5, 5.0],
  "personality": [],
  "attitude": [],
  "skills": {
    "priority_skills": ["chƒÉm s√≥c v·∫øt th∆∞∆°ng", "ƒëo d·∫•u hi·ªáu sinh t·ªìn"],
    "required_skills": [
      "ti√™m insulin",
      "ƒëo ƒë∆∞·ªùng huy·∫øt",
      "ƒë√°i th√°o ƒë∆∞·ªùng",
      "qu·∫£n l√Ω thu·ªëc"
    ]
  },
  "time_slots": [
    { "day": "monday", "start": "08:00", "end": "12:00" },
    { "day": "wednesday", "start": "08:00", "end": "12:00" },
    { "day": "friday", "start": "08:00", "end": "12:00" }
  ],
  "location": {
    "address": "Qu·∫≠n 7, TP.HCM",
    "lat": 10.735,
    "lon": 106.72
  },
  "budget_per_hour": 110000,
  "top_n": 10
}
```

**Request Schema:**

```json
{
  "type": "object",
  "properties": {
    "seeker_name": {
      "type": "string",
      "description": "T√™n ng∆∞·ªùi t√¨m ki·∫øm"
    },
    "care_level": {
      "type": "integer",
      "description": "M·ª©c ƒë·ªô chƒÉm s√≥c (1-4)",
      "minimum": 1,
      "maximum": 4
    },
    "health_status": {
      "type": "string",
      "enum": ["good", "moderate", "weak"],
      "description": "T√¨nh tr·∫°ng s·ª©c kh·ªèe"
    },
    "elderly_age": {
      "type": "integer",
      "description": "Tu·ªïi ng∆∞·ªùi gi√†",
      "minimum": 50,
      "maximum": 100
    },
    "caregiver_age_range": {
      "type": "array",
      "items": { "type": "integer" },
      "minItems": 2,
      "maxItems": 2,
      "description": "Kho·∫£ng tu·ªïi caregiver [min, max]"
    },
    "gender_preference": {
      "type": "string",
      "enum": ["male", "female", null],
      "description": "Gi·ªõi t√≠nh ∆∞u ti√™n"
    },
    "required_years_experience": {
      "type": "integer",
      "minimum": 0,
      "description": "S·ªë nƒÉm kinh nghi·ªám y√™u c·∫ßu"
    },
    "overall_rating_range": {
      "type": "array",
      "items": { "type": "number" },
      "minItems": 2,
      "maxItems": 2,
      "description": "Kho·∫£ng ƒëi·ªÉm ƒë√°nh gi√° [min, max]"
    },
    "personality": {
      "type": "array",
      "items": { "type": "string" },
      "description": "Danh s√°ch t√≠nh c√°ch ∆∞u ti√™n"
    },
    "attitude": {
      "type": "array",
      "items": { "type": "string" },
      "description": "Danh s√°ch th√°i ƒë·ªô ∆∞u ti√™n"
    },
    "skills": {
      "type": "object",
      "properties": {
        "priority_skills": {
          "type": "array",
          "items": { "type": "string" },
          "description": "K·ªπ nƒÉng ∆∞u ti√™n"
        },
        "required_skills": {
          "type": "array",
          "items": { "type": "string" },
          "description": "K·ªπ nƒÉng b·∫Øt bu·ªôc"
        }
      },
      "required": ["priority_skills", "required_skills"]
    },
    "time_slots": {
      "type": "array",
      "items": {
        "type": "object",
        "properties": {
          "day": {
            "type": "string",
            "enum": [
              "monday",
              "tuesday",
              "wednesday",
              "thursday",
              "friday",
              "saturday",
              "sunday"
            ]
          },
          "start": {
            "type": "string",
            "pattern": "^([0-1]?[0-9]|2[0-3]):[0-5][0-9]$",
            "description": "Th·ªùi gian b·∫Øt ƒë·∫ßu (HH:MM)"
          },
          "end": {
            "type": "string",
            "pattern": "^([0-1]?[0-9]|2[0-3]):[0-5][0-9]$",
            "description": "Th·ªùi gian k·∫øt th√∫c (HH:MM)"
          }
        },
        "required": ["day", "start", "end"]
      },
      "description": "Danh s√°ch khung gi·ªù l√†m vi·ªác"
    },
    "location": {
      "type": "object",
      "properties": {
        "address": { "type": "string" },
        "lat": { "type": "number" },
        "lon": { "type": "number" }
      },
      "required": ["address", "lat", "lon"]
    },
    "budget_per_hour": {
      "type": "integer",
      "minimum": 0,
      "description": "Ng√¢n s√°ch m·ªói gi·ªù (VND)"
    },
    "top_n": {
      "type": "integer",
      "minimum": 1,
      "maximum": 50,
      "default": 10,
      "description": "S·ªë l∆∞·ª£ng k·∫øt qu·∫£ t·ªëi ƒëa"
    }
  },
  "required": [
    "seeker_name",
    "care_level",
    "health_status",
    "elderly_age",
    "caregiver_age_range",
    "required_years_experience",
    "overall_rating_range",
    "personality",
    "attitude",
    "skills",
    "time_slots",
    "location",
    "budget_per_hour"
  ]
}
```

**Response:** Gi·ªëng nh∆∞ `/api/match` nh∆∞ng ƒë∆∞·ª£c t·ªëi ∆∞u cho mobile app.

---

## üìä Data Models

### CaregiverRecommendation

```json
{
  "type": "object",
  "properties": {
    "rank": {
      "type": "integer",
      "description": "Th·ª© h·∫°ng"
    },
    "caregiver_id": {
      "type": "string",
      "description": "ID c·ªßa caregiver"
    },
    "name": {
      "type": "string",
      "description": "T√™n caregiver"
    },
    "age": {
      "type": "integer",
      "description": "Tu·ªïi"
    },
    "gender": {
      "type": "string",
      "enum": ["male", "female"],
      "description": "Gi·ªõi t√≠nh"
    },
    "rating": {
      "type": "number",
      "minimum": 0,
      "maximum": 5,
      "description": "ƒêi·ªÉm ƒë√°nh gi√°"
    },
    "total_reviews": {
      "type": "integer",
      "minimum": 0,
      "description": "T·ªïng s·ªë ƒë√°nh gi√°"
    },
    "years_experience": {
      "type": "integer",
      "minimum": 0,
      "description": "S·ªë nƒÉm kinh nghi·ªám"
    },
    "price_per_hour": {
      "type": "integer",
      "minimum": 0,
      "description": "Gi√° m·ªói gi·ªù (VND)"
    },
    "distance_km": {
      "type": "number",
      "minimum": 0,
      "description": "Kho·∫£ng c√°ch (km)"
    },
    "distance": {
      "type": "string",
      "description": "Kho·∫£ng c√°ch ƒë·ªãnh d·∫°ng (VD: '2.5 km')"
    },
    "avatar": {
      "type": "string",
      "format": "uri",
      "description": "URL avatar"
    },
    "experience": {
      "type": "string",
      "description": "M√¥ t·∫£ kinh nghi·ªám"
    },
    "isVerified": {
      "type": "boolean",
      "description": "Tr·∫°ng th√°i x√°c th·ª±c"
    },
    "match_score": {
      "type": "number",
      "minimum": 0,
      "maximum": 1,
      "description": "ƒêi·ªÉm ph√π h·ª£p t·ªïng th·ªÉ"
    },
    "match_percentage": {
      "type": "string",
      "description": "Ph·∫ßn trƒÉm ph√π h·ª£p (VD: '76%')"
    },
    "score_breakdown": {
      "$ref": "#/components/schemas/ScoreBreakdown"
    }
  }
}
```

### ScoreBreakdown

```json
{
  "type": "object",
  "properties": {
    "credential": {
      "type": "number",
      "minimum": 0,
      "maximum": 1,
      "description": "ƒêi·ªÉm b·∫±ng c·∫•p/ch·ª©ng ch·ªâ"
    },
    "skills": {
      "type": "number",
      "minimum": 0,
      "maximum": 1,
      "description": "ƒêi·ªÉm k·ªπ nƒÉng"
    },
    "distance": {
      "type": "number",
      "minimum": 0,
      "maximum": 1,
      "description": "ƒêi·ªÉm kho·∫£ng c√°ch"
    },
    "time": {
      "type": "number",
      "minimum": 0,
      "maximum": 1,
      "description": "ƒêi·ªÉm th·ªùi gian"
    },
    "rating": {
      "type": "number",
      "minimum": 0,
      "maximum": 1,
      "description": "ƒêi·ªÉm ƒë√°nh gi√°"
    },
    "experience": {
      "type": "number",
      "minimum": 0,
      "maximum": 1,
      "description": "ƒêi·ªÉm kinh nghi·ªám"
    },
    "price": {
      "type": "number",
      "minimum": 0,
      "maximum": 1,
      "description": "ƒêi·ªÉm gi√° c·∫£"
    },
    "trust": {
      "type": "number",
      "minimum": 0,
      "maximum": 1,
      "description": "ƒêi·ªÉm ƒë·ªô tin c·∫≠y"
    }
  }
}
```

## üö® Error Responses

### 400 Bad Request

```json
{
  "detail": "Validation error: field 'care_level' must be between 1 and 4"
}
```

### 404 Not Found

```json
{
  "detail": "Request with ID 'req_999' not found"
}
```

### 500 Internal Server Error

```json
{
  "detail": "Internal server error: Unable to process matching request"
}
```

## üß™ Testing

### cURL Examples

**Health Check:**

```bash
curl http://localhost:8000/health
```

**Match API:**

```bash
curl -X POST "http://localhost:8000/api/match" \
     -H "Content-Type: application/json" \
     -d '{"request_id": "req_001"}'
```

**Mobile Match API:**

```bash
curl -X POST "http://localhost:8000/api/match-mobile" \
     -H "Content-Type: application/json" \
     -d '{
       "seeker_name": "Test User",
       "care_level": 2,
       "health_status": "good",
       "elderly_age": 70,
       "caregiver_age_range": [25, 60],
       "gender_preference": null,
       "required_years_experience": 2,
       "overall_rating_range": [3.0, 5.0],
       "personality": [],
       "attitude": [],
       "skills": {
         "priority_skills": ["n·∫•u ƒÉn"],
         "required_skills": ["h·ªó tr·ª£ v·ªá sinh"]
       },
       "time_slots": [
         {"day": "monday", "start": "09:00", "end": "17:00"}
       ],
       "location": {
         "address": "Qu·∫≠n 1, TP.HCM",
         "lat": 10.7769,
         "lon": 106.7009
       },
       "budget_per_hour": 80000,
       "top_n": 5
     }'
```

### JavaScript Examples

**Fetch API:**

```javascript
// Health check
const healthResponse = await fetch("http://localhost:8000/health");
const healthData = await healthResponse.json();

// Match API
const matchResponse = await fetch("http://localhost:8000/api/match", {
  method: "POST",
  headers: {
    "Content-Type": "application/json",
  },
  body: JSON.stringify({
    request_id: "req_001",
  }),
});
const matchData = await matchResponse.json();
```

**Axios:**

```javascript
import axios from "axios";

// Health check
const healthData = await axios.get("http://localhost:8000/health");

// Match API
const matchData = await axios.post("http://localhost:8000/api/match", {
  request_id: "req_001",
});
```

## üì± Mobile Integration

### React Native Example

```javascript
import axios from "axios";

const apiClient = axios.create({
  baseURL: "http://192.168.2.224:8000",
  timeout: 30000,
  headers: {
    "Content-Type": "application/json",
  },
});

const matchCaregivers = async (requestData) => {
  try {
    const response = await apiClient.post("/api/match-mobile", requestData);
    return response.data;
  } catch (error) {
    console.error("API Error:", error.response?.data || error.message);
    throw error;
  }
};
```

## üîí Security

- **CORS**: ƒê√£ ƒë∆∞·ª£c c·∫•u h√¨nh ƒë·ªÉ cho ph√©p t·∫•t c·∫£ origins
- **Input Validation**: S·ª≠ d·ª•ng Pydantic ƒë·ªÉ validate input
- **Error Handling**: Comprehensive error handling v√† logging
- **Rate Limiting**: Ch∆∞a implement (TODO)

## üìà Performance

- **Response Time**: < 500ms cho requests th√¥ng th∆∞·ªùng
- **Concurrent Requests**: H·ªó tr·ª£ multiple concurrent requests
- **Memory Usage**: Optimized cho large datasets
- **Caching**: Ch∆∞a implement (TODO)

## üîÑ Versioning

- **Current Version**: 1.0.0
- **API Versioning**: Ch∆∞a implement (TODO)
- **Backward Compatibility**: Maintained trong c√πng major version
